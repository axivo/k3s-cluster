---
- name: Set environment variables fact
  ansible.builtin.set_fact:
    helm_environment_vars:
      HELM_CACHE_HOME: /tmp/helm
      HELM_CONFIG_HOME: '{{ helm_vars.directory.share }}/config'
      HELM_DATA_HOME: '{{ helm_vars.directory.share }}'
      HELM_NAMESPACE: '{{ helm_vars.namespace }}'
      HELM_PLUGINS: '{{ helm_vars.directory.share }}/plugins'
      HELM_REGISTRY_CONFIG: '{{ helm_vars.directory.share }}/config/registry/config.json'
      HELM_REPOSITORY_CACHE: /tmp/helm/repository
      HELM_REPOSITORY_CONFIG: '{{ helm_vars.directory.share }}/config/repositories.yaml'
  run_once: true

- name: Set plugin packages fact
  ansible.builtin.set_fact:
    helm_plugin_packages: '{{ alpha.packages }}'
  loop: '{{ helm_vars.plugins }}'
  loop_control:
    loop_var: alpha
  run_once: true
  when:
    - alpha.enabled
    - alpha.packages is defined

- name: Set plugin packages disabled fact
  ansible.builtin.set_fact:
    helm_plugin_packages_disabled: '{{ beta.packages }}'
  loop: '{{ helm_vars.plugins }}'
  loop_control:
    loop_var: beta
  run_once: true
  when:
    - not beta.enabled
    - beta.packages is defined

- name: Set release channel fact
  ansible.builtin.set_fact:
    helm_release_channel: '{{ helm_vars.release.repository.url }}/{{ helm_vars.release.repository.channel }}'
  run_once: true

- name: Set release key fact
  ansible.builtin.set_fact:
    helm_release_key: '{{ helm_vars.release.repository.url }}/{{ helm_vars.release.repository.key }}'
  run_once: true
